# 修改配置文件

在进行安装 OCP 之前，您需对配置文件进行修改。

## 前提条件

* 已参见 [安装准备](4.installation-preparation.md) 获取 `ocp-3.3.0-ce.tar.gz` 软件包。
* 文件中的地址信息不可以使用 127.0.0.1、localhost 或者主机名。
* 当宿主机同时具有公网 IP 和私网 IP 时，若私网 IP 可访问，建议配置私网 IP 以提高传输文件的速度。
* 如果配置了 VIP，需要提前完成申请和绑定，部署程序不会做 VIP 相关的部署工作，只是使用配置的 VIP 地址来进行访问。

## 操作步骤

1. 将 `ocp-3.3.0-ce.tar.gz` 上传到宿主机任一目录，并进行解压。解压后获得以下文件：
   * `ocp_installer.sh`：OCP 安装脚本
   * `ocp.tar.gz`：OCP 镜像文件
   * `ocp-installer.tar.gz`：OCP 安装程序镜像文件
   * `config.yaml`：OCP 配置文件

2. 根据实际部署情况，修改 `config.yaml` 配置文件。
   配置文件主要包括以下几个部分，您需要根据实际环境情况进行配置：
   * MetaDB 集群配置
   * SSH 认证
   * OCP 相关配置
   * 其他配置
  
    ```bash
    
    # OCP deploy config
    # Note:
    # Do not use 127.0.0.1 or hostname as server address
    # When a server has both public ip and private ip, if private ip is connectable, use private ip for faster connection
    # If a vip is configured, it should be already created and bonded to the right server and port, the installation script won't do any work with vip maintainance, just use it to connect to the service

    # Ignore precheck errors
    # It's recommanded to not ignore precheck errors
    precheck_ignore: false

    # Create an obcluster as OCP's metadb
    create_metadb_cluster: false

    # Clean OCP's metadb cluster when uninstall
    clean_metadb_cluster: false

    # Metadb cluster deploy config
    ob_cluster:
        name: obcluster
        home_path: /home/admin/oceanbase
        root_password: 'rootpass'
        # The directory for data storage, it's recommanded to use an independent path
        data_path: /data/1
        # The directory for clog, ilog, and slog, it's recommanded to use an independent path.
        redo_path: /data/log1
        sql_port: 2881
        rpc_port: 2882
        zones:
          - name: zone1
            servers:
              - 1.1.1.1

        # Meta user info
        meta:
            tenant: meta_tenant
            user: meta_user
            password: meta_password
            database: meta_database
            cpu: 2
            # Memory configs in GB, 4 means 4GB
            memory: 4

        # Monitor user info
        monitor:
            tenant: monitor_tenant
            user: monitor_user
            password: monitor_password
            database: monitor_database
            cpu: 4
            # Memory configs in GB, 8 means 8GB
            memory: 8

    # Obproxy to connect metadb cluster
    obproxy:
        home_path: /home/admin/obproxy
        port: 2883
        servers:
          - 1.1.1.1
        # Vip is optional, if vip is not configured, one of obproxy servers's address will be used
        # vip:
        #   address: 1.1.1.1
        #   port: 2883

    # Ssh auth config
    ssh:
        port: 22
        user: root
        # auth method, support password and pubkey
        auth_method: password
        timeout: 10
        password: password

    # OCP config
    ocp:
        # ocp container's name
        name: 'ocp'

        # OCP process listen port and log dir on host
        process:
            port: 8080
            log_dir: /tmp/ocp/log
        servers:
          - 1.1.1.1
        # OCP container's resource
        resource:
            cpu: 4
            # Memory configs in GB, 8 means 8GB
            memory: 8
        # Vip is optional, if vip is not configured, one of ocp servers's address will be used
        # vip:
        #   address: 1.1.1.1
        #   port: 8080
        # OCP basic auth config, used when upgrade ocp
        auth:
            user: admin
            password: root
        # OCP metadb config, for ocp installation, if "create_metadb_cluster" is configured true, this part will be replaced with the configuration of metadb cluster and obproxy
        metadb:
            host: 1.1.1.1
            port: 2883
            meta_user: meta_user@meta_tenant#obcluster
            meta_password: meta_password
            meta_database: meta_database
            monitor_user: monitor_user@monitor_tenant#obcluster
            monitor_password: monitor_password
            monitor_database: monitor_database
    ```
